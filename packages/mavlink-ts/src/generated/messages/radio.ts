/**
 * Status generated by radio.
 * Message ID: 166
 * CRC Extra: 21
 */
export interface Radio {
  /** Local signal strength. */
  rssi: number;
  /** Remote signal strength. */
  remrssi: number;
  /** How full the tx buffer is. (%) */
  txbuf: number;
  /** Background noise level. */
  noise: number;
  /** Remote background noise level. */
  remnoise: number;
  /** Receive errors. */
  rxerrors: number;
  /** Count of error corrected packets. */
  fixed: number;
}

export const RADIO_ID = 166;
export const RADIO_CRC_EXTRA = 21;
export const RADIO_MIN_LENGTH = 9;
export const RADIO_MAX_LENGTH = 9;

export function serializeRadio(msg: Radio): Uint8Array {
  const buffer = new Uint8Array(9);
  const view = new DataView(buffer.buffer);

  view.setUint16(0, msg.rxerrors, true);
  view.setUint16(2, msg.fixed, true);
  buffer[4] = msg.rssi & 0xff;
  buffer[5] = msg.remrssi & 0xff;
  buffer[6] = msg.txbuf & 0xff;
  buffer[7] = msg.noise & 0xff;
  buffer[8] = msg.remnoise & 0xff;

  return buffer;
}

export function deserializeRadio(payload: Uint8Array): Radio {
  const view = new DataView(payload.buffer, payload.byteOffset, payload.byteLength);

  return {
    rxerrors: view.getUint16(0, true),
    fixed: view.getUint16(2, true),
    rssi: payload[4],
    remrssi: payload[5],
    txbuf: payload[6],
    noise: payload[7],
    remnoise: payload[8],
  };
}