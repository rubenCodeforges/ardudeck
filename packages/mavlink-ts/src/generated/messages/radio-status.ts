/**
 * Status generated by radio and injected into MAVLink stream.
 * Message ID: 109
 * CRC Extra: 185
 */
export interface RadioStatus {
  /** Local (message sender) received signal strength indication in device-dependent units/scale. Values: [0-254], 255: invalid/unknown. */
  rssi: number;
  /** Remote (message receiver) signal strength indication in device-dependent units/scale. Values: [0-254], 255: invalid/unknown. */
  remrssi: number;
  /** Remaining free transmitter buffer space. (%) */
  txbuf: number;
  /** Local background noise level. These are device dependent RSSI values (scale as approx 2x dB on SiK radios). Values: [0-254], 255: invalid/unknown. */
  noise: number;
  /** Remote background noise level. These are device dependent RSSI values (scale as approx 2x dB on SiK radios). Values: [0-254], 255: invalid/unknown. */
  remnoise: number;
  /** Count of radio packet receive errors (since boot). */
  rxerrors: number;
  /** Count of error corrected radio packets (since boot). */
  fixed: number;
}

export const RADIO_STATUS_ID = 109;
export const RADIO_STATUS_CRC_EXTRA = 185;
export const RADIO_STATUS_MIN_LENGTH = 9;
export const RADIO_STATUS_MAX_LENGTH = 9;

export function serializeRadioStatus(msg: RadioStatus): Uint8Array {
  const buffer = new Uint8Array(9);
  const view = new DataView(buffer.buffer);

  view.setUint16(0, msg.rxerrors, true);
  view.setUint16(2, msg.fixed, true);
  buffer[4] = msg.rssi & 0xff;
  buffer[5] = msg.remrssi & 0xff;
  buffer[6] = msg.txbuf & 0xff;
  buffer[7] = msg.noise & 0xff;
  buffer[8] = msg.remnoise & 0xff;

  return buffer;
}

export function deserializeRadioStatus(payload: Uint8Array): RadioStatus {
  const view = new DataView(payload.buffer, payload.byteOffset, payload.byteLength);

  return {
    rxerrors: view.getUint16(0, true),
    fixed: view.getUint16(2, true),
    rssi: payload[4],
    remrssi: payload[5],
    txbuf: payload[6],
    noise: payload[7],
    remnoise: payload[8],
  };
}